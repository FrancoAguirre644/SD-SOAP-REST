<!doctype html>
<html lang="en">
 <head>
  	<title>Perfil</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" href="../../css/registro/style.css">
	
	<link rel="stylesheet" href="../../css/perfil/style.css">

</head>
	
<body>
	<div th:insert="generic/navBar.html"> </div>
                    
	<section class="profile">
  		<header class="header">
    		<div class="details">
      			<img src="https://upload.wikimedia.org/wikipedia/commons/d/d3/User_Circle.png" class="profile-pic">
      			<h1 class="heading"  th:text="${perfil.username}"></h1>
    		</div>    		
    		<div  class="alert" th:classappend="'alert-' + (${clase != null} ? ${clase} +' alert-dismissible' : info + ' alert-dismissible')" aria-hidden="true" th:if="${mensaje != null}">
            	<button type="button" class="close " aria-hidden="true" data-dismiss="alert">&times;</button>
                <span th:text="${mensaje}"></span>
            </div>
  		</header>
	</section>
	
	<div class="row align-items-center justify-content-center text-center">
		<div class="col-md-8">
			<div class="card mb-3">
				<div class="card-body">
					<div class="row">
						<div class="col-sm-3">
							<p class="mb-0">Nombre</p>
						</div>
						<div class="col-sm-9 text-secondary">
							<p th:text="${perfil.nombre}"></p>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-3">
							<p class="mb-0">Apellido</p>
						</div>
						<div class="col-sm-9 text-secondary">
							<p th:text="${perfil.apellido}"></p>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-3">
							<p class="mb-0">D.N.I</p>
						</div>
						<div class="col-sm-9 text-secondary">
							<p th:text="${perfil.dni}"></p>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-3">
							<p class="mb-0">Teléfono</p>
						</div>
						<div class="col-sm-9 text-secondary">
							<p th:text="${perfil.telefono}"></p>
						</div>
					</div>
				</div>
						
				<!-- Modal 1 -->
				<div class="modal fade" id="modalCambiarDatos" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
					 aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLongTitle">Cambiar Datos</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<form th:object="${perfil}">
									<div class="row">
										<div class="col-sm-11 col-md-12">
											<div class="form-group" style="display:none">
												<label>ID:</label>
												<input th:field="*{id}" id="id" type="text" class="form-control" />
											</div>
											<div class="form-group">
												<label for="">Nombre</label>
												<input th:field="*{nombre}" type="text" id="nombre" class="form-control" />
											</div>
											<div class="form-group">
												<label for="">Apellido</label>
												<input th:field="*{apellido}" type="text" id="apellido" class="form-control" />
											</div>
											<div class="form-group">
												<label for="">D.N.I</label>
												<input th:field="*{dni}" type="text" id="dni" class="form-control" />
											</div>
											<div class="form-group">
												<label for="">Teléfono</label>
												<input th:field="*{telefono}" type="text" id="telefono" class="form-control" />
											</div>
				
										</div>
										<div class="col-sm-1 col-md-12">
											<div class="col-md-12 text-center">
												<div class="form-group">
													<button type="submit" id="actualizarDatosPersonales" class="btn btn-info">Aceptar</button>
												</div>
											</div>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>


				<div class="row">
					<div class="col-sm-12">
						<button title="Modificar" type="submit" class="float-right btn btn-info"
							aria-hidden="true" id="modificar" data-toggle="modal"
							data-target="#modalCambiarDatos">Modificar Datos</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="row align-items-center justify-content-center text-center">
		
		<div th:if="${not #lists.isEmpty(domicilios)}">LISTA DE DIRECCIONES CARGADAS
			<div th:if="${!domicilios.empty}">
				<span th:each="domicilio: ${domicilios}">
					<div class="card" style="width: 100%; margin-bottom:20px;">
						<div class="row">
							<div class="col-sm-8">
								<div class="card-body">
									<p th:text="${domicilio.calle}" class="card-title"></p>
									<p th:text="${domicilio.numero}" class="card-text"></p>
									<h6 th:text="${domicilio.codigoPostal}"></h6>
									<p th:text="${domicilio.provincia}" class="card-text"></p>
								</div>
							</div>
						</div>
					</div>
				</span>
			</div>
		</div>

		<!-- Modal 2 -->
		<div class="modal fade" id="modalAgregarDireccion" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLongTitle">Agregar una dirección</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
				<div class="modal-body">
					<form th:action="@{altaDireccion}" th:object="${direccion}" method="post">
						<div class="row">
							<div class="col-sm-11 col-md-12">
								<div class="form-group">
									<label for="">Calle</label>
									<input  type="text" name="calle" class="form-control" required />
								</div>
								<div class="form-group">
									<label for="">Número</label>
									<input  type="number" name="numero" class="form-control" required />
								</div>
								<div class="form-group">
									<label for="">Código postal</label>
									<input  type="text" name="codigoPostal" class="form-control" required />
								</div>
								<div class="form-group">
									<label for="">Provincia</label>
									<input  type="text" name="provincia" class="form-control" required />
								</div>			
							</div>
							<div class="col-sm-1 col-md-12">
								<div class="col-md-12 text-center">
									<div class="form-group">
										<button type="submit" class="btn btn-info">Guardar</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-sm-12">
			<button title="Modificar" type="submit" class="float-right btn btn-info"
				aria-hidden="true" id="direccion" data-toggle="modal"
				data-target="#modalAgregarDireccion">Alta dirección</button>
		</div>
	</div>
</div>

	<div class="row align-items-center justify-content-center text-center">
		
		<div th:if="${not #lists.isEmpty(tarjetas)}">LISTA DE TARJETAS CARGADAS
			<div th:if="${!tarjetas.empty}">
				<span th:each="tarjeta: ${tarjetas}">
					<div class="card" style="width: 100%; margin-bottom:20px;">
						<div class="row">
							<div class="col-sm-8">
								<div class="card-body">
									<p th:text="${tarjeta.tipo}" class="card-title"></p>
									<p th:text="${tarjeta.numero}" class="card-text"></p>
								</div>
							</div>
						</div>
					</div>
				</span>
			</div>
		</div>
	<!-- Modal 3 -->
		<div class="modal fade" id="modalAgregarTarjeta" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLongTitle">Agregar una tarjeta de débito / crédito</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
				<div class="modal-body">
					<form th:action="@{altaTarjeta}" th:object="${tarjeta}" method="post">
						<div class="row">
							<div class="col-sm-11 col-md-12">
								<div class="form-group">
									<label for="">Tipo de tarjeta</label>
									<select name="tipo" required>
									  <option value="Debito">Debito</option>
									  <option value="Credito">Credito</option>
									</select>
								</div>
								<div class="form-group">
									<label for="">Número</label>
									<input  type="text" name="numero" class="form-control" required />
								</div>
								
							</div>
							<div class="col-sm-1 col-md-12">
								<div class="col-md-12 text-center">
									<div class="form-group">
										<button type="submit" class="btn btn-info">Guardar tarjeta</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-sm-12">
			<button title="Modificar" type="submit" class="float-right btn btn-info"
				aria-hidden="true" id="direccion" data-toggle="modal"
				data-target="#modalAgregarTarjeta">Alta tarjeta</button>
		</div>
	</div>


	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

						
	<script>
		$( document ).ready(function() {
			$("#modalCambiarDatos #actualizarDatosPersonales").on("click",function () {
	        	         console.log("ENTRÓ");
	            var user = {
						  "id": $("#id").val(),
	            		  "nombre": $("#nombre").val(),
	            		  "apellido": $("#apellido").val(),
	            		  "dni": $("#dni").val(),
	            		  "telefono": $("#telefono").val(),
	            		 }
	            
	            $.ajax({
					type : "POST",
					url : "/api/perfil/updateProfile",
					contentType: "application/json",
					data: JSON.stringify(user),
			        cache: false,
			        timeout: 600000,
					success : function(result) {
							alert("Perfil actualizado correctamente");						
						
							window.location.reload();
						
					},
					error : function(e) {
							alert("Error al actualizar el perfil");
					}
				});
	
	        });
         });
		</script>	
</body>

</html>